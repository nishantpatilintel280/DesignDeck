@page
@model EP.Pages.DetailsModel
@{
    ViewData["Title"] = "Details";
    Layout = "_Layout";
}
<link rel="stylesheet" href="~/css/details.css" asp-append-version="true" />

@section Scripts {
    <script src="~/js/Details.js" asp-append-version="true"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const designForm = document.getElementById('designForm');
            const specsForm = document.getElementById('specsForm');
            const saveBtn = document.getElementById('saveSpecsBtn');
            if (!saveBtn) return;
            const enable = () => { saveBtn.disabled = false; };
            [designForm, specsForm].forEach(form => {
                if (!form) return;
                form.querySelectorAll('input, select, textarea').forEach(el => {
                    el.addEventListener('input', enable);
                    el.addEventListener('change', enable);
                });
            });
            saveBtn.addEventListener('click', function(){
                // submit both forms on save
                if (designForm) designForm.requestSubmit();
                if (specsForm) specsForm.requestSubmit();
            });
        });
    </script>
}

<div class="container-fluid py-5">
    @if (Model.Design != null)
    {
        <!-- Main Design Header Card -->
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="h5 mb-1">@Model.Design.Name</h2>
                        <div class="text-muted small">Platform: <span class="badge text-bg-light">@Model.Design.Platform</span> · SKU: <span class="badge text-bg-light">@Model.Design.SKU</span> · OEM: <span class="badge text-bg-light">@Model.Design.OEM</span></div>
                        <form method="post" asp-page-handler="SaveDesign" id="designForm" class="mt-2">
                            <input type="hidden" name="DesignEditModel.DesignId" value="@Model.Design.Id" />
                            <div class="row g-2 align-items-center">
                                <div class="col-auto">ODM:</div>
                                <div class="col"><input class="form-control form-control-sm" name="DesignEditModel.ODM" value="@Model.DesignEditModel?.ODM" /></div>
                                <div class="col-auto">IF:</div>
                                <div class="col"><input class="form-control form-control-sm" name="DesignEditModel.IF_" value="@Model.DesignEditModel?.IF_" /></div>
                                <div class="col-auto">FCS:</div>
                                <div class="col"><input class="form-control form-control-sm" name="DesignEditModel.FCS" value="@Model.DesignEditModel?.FCS" /></div>
                            </div>
                        </form>
                    </div>
                    <div class="d-flex gap-2 align-items-center">
                        
                        <a href="/Index" class="btn btn-outline-secondary btn-sm">Back</a>
                        <button type="button" id="saveSpecsBtn" class="btn btn-primary btn-sm" disabled>Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Design Details Accordion -->
        <div class="card mb-3">
                        
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-info-circle me-2"></i>Complete Design Details
                </h5>
            </div>
            <div class="card-body">
                <div class="accordion" id="designDetailsAccordion">
                    <!-- Hardware Configuration -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="hdg-hardware">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-hardware" aria-expanded="false">
                                <i class="bi bi-cpu me-2"></i>Hardware Configuration
                            </button>
                        </h2>
                        <div id="collapse-hardware" class="accordion-collapse collapse" aria-labelledby="hdg-hardware">
                            <div class="accordion-body">
                                <div class="row g-3">
                                    <div class="col-md-4"><label class="form-label">Segment</label><input class="form-control form-control-sm" name="DesignEditModel.Segment" form="designForm" value="@Model.DesignEditModel?.Segment" /></div>
                                    <div class="col-md-4"><label class="form-label">Config</label><input class="form-control form-control-sm" name="DesignEditModel.Config" form="designForm" value="@Model.DesignEditModel?.Config" /></div>
                                    <div class="col-md-4"><label class="form-label">PL Values</label><input class="form-control form-control-sm" name="DesignEditModel.PlValues" form="designForm" value="@Model.DesignEditModel?.PlValues" /></div>
                                    <div class="col-md-4"><label class="form-label">Memory</label><input class="form-control form-control-sm" name="DesignEditModel.MemoryCapacity" form="designForm" value="@Model.DesignEditModel?.MemoryCapacity" /></div>
                                    <div class="col-md-4"><label class="form-label">Form Factor</label><input class="form-control form-control-sm" name="DesignEditModel.FormFactor" form="designForm" value="@Model.DesignEditModel?.FormFactor" /></div>
                                    <div class="col-md-4"><label class="form-label">SOC</label><input class="form-control form-control-sm" name="DesignEditModel.Soc" form="designForm" value="@Model.DesignEditModel?.Soc" /></div>
                                    <div class="col-md-4"><label class="form-label">PCH</label><input class="form-control form-control-sm" name="DesignEditModel.Pch" form="designForm" value="@Model.DesignEditModel?.Pch" /></div>
                                    <div class="col-md-4"><label class="form-label">UMA</label><input class="form-control form-control-sm" name="DesignEditModel.Uma" form="designForm" value="@Model.DesignEditModel?.Uma" /></div>
                                    <div class="col-md-4"><label class="form-label">Hybrid GFX</label><input class="form-control form-control-sm" name="DesignEditModel.HybridGfx" form="designForm" value="@Model.DesignEditModel?.HybridGfx" /></div>
                                    <div class="col-md-4"><label class="form-label">dGPU Vendor</label><input class="form-control form-control-sm" name="DesignEditModel.DgpuVendor" form="designForm" value="@Model.DesignEditModel?.DgpuVendor" /></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Test Timeline -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="hdg-timeline">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-timeline" aria-expanded="false">
                                <i class="bi bi-calendar-event me-2"></i>Test Timeline
                            </button>
                        </h2>
                        <div id="collapse-timeline" class="accordion-collapse collapse" aria-labelledby="hdg-timeline">
                            <div class="accordion-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">EVT Phase Start</label>
                                        <input class="form-control form-control-sm" name="DesignEditModel.EvtStart" form="designForm" value="@Model.DesignEditModel?.EvtStart" />
                                        <label class="form-label">EVT Phase End</label>
                                        <input class="form-control form-control-sm" name="DesignEditModel.EvtEnd" form="designForm" value="@Model.DesignEditModel?.EvtEnd" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">FVT Phase Start</label>
                                        <input class="form-control form-control-sm" name="DesignEditModel.FvtStart" form="designForm" value="@Model.DesignEditModel?.FvtStart" />
                                        <label class="form-label">FVT Phase End</label>
                                        <input class="form-control form-control-sm" name="DesignEditModel.FvtEnd" form="designForm" value="@Model.DesignEditModel?.FvtEnd" />
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">SIT Phase Start</label>
                                        <input class="form-control form-control-sm" name="DesignEditModel.SitStart" form="designForm" value="@Model.DesignEditModel?.SitStart" />
                                        <label class="form-label">SIT Phase End</label>
                                        <input class="form-control form-control-sm" name="DesignEditModel.SitEnd" form="designForm" value="@Model.DesignEditModel?.SitEnd" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Features & Certifications -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="hdg-features">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-features" aria-expanded="false">
                                <i class="bi bi-star me-2"></i>Features & Certifications
                            </button>
                        </h2>
                        <div id="collapse-features" class="accordion-collapse collapse" aria-labelledby="hdg-features">
                            <div class="accordion-body">
                                <div class="row g-3">
                                    <div class="col-md-4"><label class="form-label">Athena/Evo Candidate</label><input class="form-control form-control-sm" name="DesignEditModel.AthenaEvoCandidate" form="designForm" value="@Model.DesignEditModel?.AthenaEvoCandidate" /></div>
                                    <div class="col-md-4"><label class="form-label">Gaming</label><input class="form-control form-control-sm" name="DesignEditModel.Gaming" form="designForm" value="@Model.DesignEditModel?.Gaming" /></div>
                                    <div class="col-md-4"><label class="form-label">AI Features</label><input class="form-control form-control-sm" name="DesignEditModel.AiFeatures" form="designForm" value="@Model.DesignEditModel?.AiFeatures" /></div>
                                    <div class="col-md-4"><label class="form-label">POST Config</label><input class="form-control form-control-sm" name="DesignEditModel.PostConfig" form="designForm" value="@Model.DesignEditModel?.PostConfig" /></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Logistics & Supply Chain -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="hdg-logistics">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-logistics" aria-expanded="false">
                                <i class="bi bi-truck me-2"></i>Logistics & Supply Chain
                            </button>
                        </h2>
                        <div id="collapse-logistics" class="accordion-collapse collapse" aria-labelledby="hdg-logistics">
                            <div class="accordion-body">
                                <div class="row g-3">
                                    <div class="col-md-4"><label class="form-label">PO</label><input class="form-control form-control-sm" name="DesignEditModel.PO" form="designForm" value="@Model.DesignEditModel?.PO" /></div>
                                    <div class="col-md-4"><label class="form-label">PO Site</label><input class="form-control form-control-sm" name="DesignEditModel.POSite" form="designForm" value="@Model.DesignEditModel?.POSite" /></div>
                                    <div class="col-md-4"><label class="form-label">PV Need</label><input class="form-control form-control-sm" name="DesignEditModel.PvNeed" form="designForm" value="@Model.DesignEditModel?.PvNeed" /></div>
                                    <div class="col-md-4"><label class="form-label">Ship-out OS</label><input class="form-control form-control-sm" name="DesignEditModel.ShipOutOs" form="designForm" value="@Model.DesignEditModel?.ShipOutOs" /></div>
                                    <div class="col-md-4"><label class="form-label">HW Availability</label><input class="form-control form-control-sm" name="DesignEditModel.HwAvailability" form="designForm" value="@Model.DesignEditModel?.HwAvailability" /></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="hdg-notes">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-notes" aria-expanded="false">
                                <i class="bi bi-sticky me-2"></i>Notes
                            </button>
                        </h2>
                        <div id="collapse-notes" class="accordion-collapse collapse" aria-labelledby="hdg-notes">
                            <div class="accordion-body">
                                <textarea class="form-control" rows="3" name="DesignEditModel.Notes" form="designForm">@Model.DesignEditModel?.Notes</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <!-- Left: panel list -->
            <div class="col-lg-4">
                <!-- existing panel list card unchanged -->
                <div class="card">
                    <div class="card-body">
                        <h3 class="h6 mb-3">Panels</h3>
                        <button type="button" class="btn btn-outline-secondary btn-sm mb-3"
                                data-bs-toggle="modal" data-bs-target="#panelFilterModal">
                            <i class="bi bi-sliders me-1"></i>
                            <span class="d-none d-md-inline">Master Filter</span>
                            <span class="d-md-none">Filter</span>
                        </button>
                        @if (Model.FilterPanelFeatures != null && Model.FilterPanelFeatures.Count > 0)
                        {
                            <a class="btn btn-outline-dark btn-sm mb-3" href="@Url.Page("/Details", new { DesignId = Model.Design.Id })" title="Clear all filters">
                                <i class="bi bi-x-circle me-1"></i>
                                <span class="d-none d-md-inline">Clear filters</span>
                                <span class="d-md-none">Clear</span>
                            </a>
                        }
                        @if (Model.PanelsWithSpecs.Count == 0)
                        {
                            <div class="text-muted">No panels for this design.</div>
                        }
                        else
                        {
                            <div class="list-group">
                                @{ var i = 1; }
                                @foreach (var ps in Model.PanelsWithSpecs)
                                {
                                    var p = ps.Panel;
                                    <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center @(i == 1 ? "active" : "")"
                                       href="#panel-@i" data-bs-toggle="tab" role="tab">
                                        <span>
                                            <span class="badge text-bg-secondary me-2">@i</span>
                                            <span class="fw-medium">@p.panel_vendor</span>
                                            <span class="text-muted ms-2">@p.tcon_vendor</span>
                                        </span>
                                        <i class="bi bi-chevron-right"></i>
                                    </a>
                                    i++;
                                }
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Right: details accordion (editable) -->
            <div class="col-lg-8">
                @if (Model.PanelsWithSpecs.Count > 0)
                {
                    <form method="post" asp-page-handler="SaveSpecs" id="specsForm">
                        <input type="hidden" name="DesignId" value="@Model.Design?.Id" />
                        <!-- existing specs tabs/accordions unchanged -->
                        <div class="card">
                            <div class="card-body">
                                <div class="tab-content">
                                    @{ var j = 1; var index = 0; }
                                    @foreach (var ps in Model.PanelsWithSpecs)
                                    {
                                        var p = ps.Panel;
                                        var s = ps.Spec;
                                        <div class="tab-pane fade @(j == 1 ? "show active" : "")" id="panel-@j" role="tabpanel">
                                            <!-- existing accordion content unchanged -->
                                            @* keep existing inputs *@
                                            <div class="accordion" id="panelAccordion-@j">
                                                <!-- Panel Make and Model Details -->
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="hdr-make-@j">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#col-make-@j" aria-expanded="false" aria-controls="col-make-@j">
                                                            Panel Make and Model Details
                                                        </button>
                                                    </h2>
                                                    <div id="col-make-@j" class="accordion-collapse collapse" aria-labelledby="hdr-make-@j">
                                                        <div class="accordion-body">
                                                            <input type="hidden" name="Specs[@index].panel_id" value="@p.panel_id" />
                                                            <ul class="list-unstyled mb-0">
                                                                <li><strong>Panel Vendor:</strong> @p.panel_vendor</li>
                                                                <li><strong>Tcon Vendor:</strong> @p.tcon_vendor</li>
                                                                <li>
                                                                    <label class="form-label d-block"><strong>Panel PN:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].Panel_Part_Number" value="@s?.Panel_Part_Number" />
                                                                </li>
                                                                <li>
                                                                    <label class="form-label d-block"><strong>TCon PN:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].TCon_Part_Number" value="@s?.TCon_Part_Number" />
                                                                </li>
                                                                <li>
                                                                    <label class="form-label d-block"><strong>TCon Release Yr:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].Panel_TCon_Release_Year" value="@s?.Panel_TCon_Release_Year" />
                                                                </li>
                                                                <li>
                                                                    <label class="form-label d-block"><strong>Panel HW Ver:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].Panel_HW_Version" value="@s?.Panel_HW_Version" />
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Panel Capabilities -->
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="hdr-cap-@j">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#col-cap-@j" aria-expanded="false" aria-controls="col-cap-@j">
                                                            Panel Capabilities
                                                        </button>
                                                    </h2>
                                                    <div id="col-cap-@j" class="accordion-collapse collapse" aria-labelledby="hdr-cap-@j">
                                                        <div class="accordion-body">
                                                            <ul class="list-unstyled mb-0">
                                                                <li><label class="form-label d-block"><strong>Panel Port #:</strong></label><input class="form-control form-control-sm" name="Specs[@index].PanelPortNumber" value="@s?.PanelPortNumber" /></li>
                                                                <li><label class="form-label d-block"><strong>EDID/Spec Ver:</strong></label><input class="form-control form-control-sm" name="Specs[@index].EdidVersion" value="@s?.EdidVersion" /></li>
                                                                <li><label class="form-label d-block"><strong>Resolution:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Resolution" value="@s?.Resolution" /></li>
                                                                <li><label class="form-label d-block"><strong>RR Min:</strong></label><input class="form-control form-control-sm" name="Specs[@index].RR_Min_Hz" value="@s?.RR_Min_Hz" /></li>
                                                                <li><label class="form-label d-block"><strong>RR Max:</strong></label><input class="form-control form-control-sm" name="Specs[@index].RR_Max_Hz" value="@s?.RR_Max_Hz" /></li>
                                                                <li><label class="form-label d-block"><strong>Aspect:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Aspect_Ratio" value="@s?.Aspect_Ratio" /></li>
                                                                <li><label class="form-label d-block"><strong>Htotal:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Htotal" value="@s?.Htotal" /></li>
                                                                <li><label class="form-label d-block"><strong>Vtotal:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Vtotal" value="@s?.Vtotal" /></li>
                                                                <li><label class="form-label d-block"><strong>Screen Size:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Screen_Size_Inch" value="@s?.Screen_Size_Inch" /></li>
                                                                <li><label class="form-label d-block"><strong>Color Depth:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Color_Depth" value="@s?.Color_Depth" /></li>
                                                                <li><label class="form-label d-block"><strong>FRC:</strong></label><input class="form-control form-control-sm" name="Specs[@index].FRC" value="@s?.FRC" /></li>
                                                                <li><label class="form-label d-block"><strong>Data Lanes:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Data_Lane_Count" value="@s?.Data_Lane_Count" /></li>
                                                                <li><label class="form-label d-block"><strong>Link Rate:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Data_Link_Rate" value="@s?.Data_Link_Rate" /></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Feature Support -->
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="hdr-feat-@j">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#col-feat-@j" aria-expanded="false" aria-controls="col-feat-@j">
                                                            Feature Support
                                                        </button>
                                                    </h2>
                                                    <div id="col-feat-@j" class="accordion-collapse collapse" aria-labelledby="hdr-feat-@j">
                                                        <div class="accordion-body">
                                                            <ul class="list-unstyled mb-0">
                                                                <li><label class="form-label d-block"><strong>PSR1:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].PSR1_Supported" value="@s?.PSR1_Supported" />
                                                                    @if (Model.PanelOverrides.TryGetValue(p.panel_id, out var panelOvr) && panelOvr.ContainsKey("PSR1_Supported"))
                                                                    {
                                                                        var ovr = panelOvr["PSR1_Supported"];
                                                                        <small class="text-info">
                                                                            <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                                                               title="Modified after FCS by @ovr.ModifiedBy on @ovr.ModifiedDate.ToString("dd-MM-yyyy HH:mm")"></i>
                                                                            Changed post-FCS
                                                                        </small>
                                                                    }
                                                                </li>
                                                                <li><label class="form-label d-block"><strong>PSR2:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].PSR2_Supported" value="@s?.PSR2_Supported" />
                                                                    @if (Model.PanelOverrides.TryGetValue(p.panel_id, out panelOvr) && panelOvr.ContainsKey("PSR2_Supported"))
                                                                    {
                                                                        var ovr = panelOvr["PSR2_Supported"];
                                                                        <small class="text-info">
                                                                            <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                                                               title="Modified after FCS by @ovr.ModifiedBy on @ovr.ModifiedDate.ToString("dd-MM-yyyy HH:mm")"></i>
                                                                            Changed post-FCS
                                                                        </small>
                                                                    }
                                                                </li>
                                                                <li><label class="form-label d-block"><strong>PSR2 ET:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].PSR2_ET_Supported" value="@s?.PSR2_ET_Supported" />
                                                                    @if (Model.PanelOverrides.TryGetValue(p.panel_id, out panelOvr) && panelOvr.ContainsKey("PSR2_ET_Supported"))
                                                                    {
                                                                        var ovr = panelOvr["PSR2_ET_Supported"];
                                                                        <small class="text-info">
                                                                            <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                                                               title="Modified after FCS by @ovr.ModifiedBy on @ovr.ModifiedDate.ToString("dd-MM-yyyy HH:mm")"></i>
                                                                            Changed post-FCS
                                                                        </small>
                                                                    }
                                                                </li>
                                                                <li><label class="form-label d-block"><strong>Intel LRR:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].Intel_LRR_Version" value="@s?.Intel_LRR_Version" />
                                                                    @if (Model.PanelOverrides.TryGetValue(p.panel_id, out panelOvr) && panelOvr.ContainsKey("Intel_LRR_Version"))
                                                                    {
                                                                        var ovr = panelOvr["Intel_LRR_Version"];
                                                                        <small class="text-info">
                                                                            <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                                                               title="Modified after FCS by @ovr.ModifiedBy on @ovr.ModifiedDate.ToString("dd-MM-yyyy HH:mm")"></i>
                                                                            Changed post-FCS
                                                                        </small>
                                                                    }
                                                                </li>
                                                                <li><label class="form-label d-block"><strong>HDR:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].HDR_Supported" value="@s?.HDR_Supported" />
                                                                    @if (Model.PanelOverrides.TryGetValue(p.panel_id, out panelOvr) && panelOvr.ContainsKey("HDR_Supported"))
                                                                    {
                                                                        var ovr = panelOvr["HDR_Supported"];
                                                                        <small class="text-info">
                                                                            <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                                                               title="Modified after FCS by @ovr.ModifiedBy on @ovr.ModifiedDate.ToString("dd-MM-yyyy HH:mm")"></i>
                                                                            Changed post-FCS
                                                                        </small>
                                                                    }
                                                                </li>
                                                                <li><label class="form-label d-block"><strong>VRR:</strong></label>
                                                                    <input class="form-control form-control-sm" name="Specs[@index].VRR_Supported" value="@s?.VRR_Supported" />
                                                                    @if (Model.PanelOverrides.TryGetValue(p.panel_id, out panelOvr) && panelOvr.ContainsKey("VRR_Supported"))
                                                                    {
                                                                        var ovr = panelOvr["VRR_Supported"];
                                                                        <small class="text-info">
                                                                            <i class="bi bi-info-circle" data-bs-toggle="tooltip" 
                                                                               title="Modified after FCS by @ovr.ModifiedBy on @ovr.ModifiedDate.ToString("dd-MM-yyyy HH:mm")"></i>
                                                                            Changed post-FCS
                                                                        </small>
                                                                    }
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Panel Color Gamut and Backlight Details -->
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="hdr-color-@j">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#col-color-@j" aria-expanded="false" aria-controls="col-color-@j">
                                                            Panel Color Gamut and Backlight Details
                                                        </button>
                                                    </h2>
                                                    <div id="col-color-@j" class="accordion-collapse collapse" aria-labelledby="hdr-color-@j">
                                                        <div class="accordion-body">
                                                            <ul class="list-unstyled mb-0">
                                                                <li><label class="form-label d-block"><strong>sRGB %:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Color_Gamut_sRGB" value="@s?.Color_Gamut_sRGB" /></li>
                                                                <li><label class="form-label d-block"><strong>DCI-P3 %:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Color_Gamut_DCI_P3" value="@s?.Color_Gamut_DCI_P3" /></li>
                                                                <li><label class="form-label d-block"><strong>AdobeRGB %:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Color_Gamut_AdobeRGB" value="@s?.Color_Gamut_AdobeRGB" /></li>
                                                                <li><label class="form-label d-block"><strong>NTSC %:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Color_Gamut_NTSC" value="@s?.Color_Gamut_NTSC" /></li>
                                                                <li><label class="form-label d-block"><strong>Max Nits:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Max_Brightness_Nits" value="@s?.Max_Brightness_Nits" /></li>
                                                                <li><label class="form-label d-block"><strong>Backlight Source:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Backlight_Light_Source" value="@s?.Backlight_Light_Source" /></li>
                                                                <li><label class="form-label d-block"><strong>Dimming:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Dimming_Control" value="@s?.Dimming_Control" /></li>
                                                                <li><label class="form-label d-block"><strong>Backlight Ctrl:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Backlight_Control" value="@s?.Backlight_Control" /></li>
                                                                <li><label class="form-label d-block"><strong>Brightness Bits:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Brightness_Precision_Bits" value="@s?.Brightness_Precision_Bits" /></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Panel touch support and interface details -->
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="hdr-touch-@j">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#col-touch-@j" aria-expanded="false" aria-controls="col-touch-@j">
                                                            Panel touch support and interface details
                                                        </button>
                                                    </h2>
                                                    <div id="col-touch-@j" class="accordion-collapse collapse" aria-labelledby="hdr-touch-@j">
                                                        <div class="accordion-body">
                                                            <ul class="list-unstyled mb-0">
                                                                <li><label class="form-label d-block"><strong>THC I2C:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Touch_Host_Controller" value="@s?.Touch_Host_Controller" /></li>
                                                                <li><label class="form-label d-block"><strong>Touch Device:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Touch_Screen_or_Pad" value="@s?.Touch_Screen_or_Pad" /></li>
                                                                <li><label class="form-label d-block"><strong>THC Vendor:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Touch_Host_Controller_Vendor" value="@s?.Touch_Host_Controller_Vendor" /></li>
                                                                <li><label class="form-label d-block"><strong>Touch Support:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Touch_Support" value="@s?.Touch_Support" /></li>
                                                                <li><label class="form-label d-block"><strong>Touch Type:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Touch_Type" value="@s?.Touch_Type" /></li>
                                                                <li><label class="form-label d-block"><strong>Touch Interface:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Touch_Interface" value="@s?.Touch_Interface" /></li>
                                                                <li><label class="form-label d-block"><strong>Stylus:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Stylus_Protocol" value="@s?.Stylus_Protocol" /></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Panel power supply and Consumption details -->
                                                <div class="accordion-item">
                                                    <h2 class="accordion-header" id="hdr-power-@j">
                                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#col-power-@j" aria-expanded="false" aria-controls="col-power-@j">
                                                            Panel power supply and Consumption details
                                                        </button>
                                                    </h2>
                                                    <div id="col-power-@j" class="accordion-collapse collapse" aria-labelledby="hdr-power-@j">
                                                        <div class="accordion-body">
                                                            <ul class="list-unstyled mb-0">
                                                                <li><label class="form-label d-block"><strong>Backlight Power:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Backlight_Power_Consumption" value="@s?.Backlight_Power_Consumption" /></li>
                                                                <li><label class="form-label d-block"><strong>Logic Power:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Data_Logic_Power_Consumption" value="@s?.Data_Logic_Power_Consumption" /></li>
                                                                <li><label class="form-label d-block"><strong>Total Power:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Total_Power_Consumption" value="@s?.Total_Power_Consumption" /></li>
                                                                <li><label class="form-label d-block"><strong>Panel DC Volt:</strong></label><input class="form-control form-control-sm" name="Specs[@index].Panel_DC_Voltage" value="@s?.Panel_DC_Voltage" /></li>
                                                                <li><label class="form-label d-block"><strong>VBatt POL:</strong></label><input class="form-control form-control-sm" name="Specs[@index].VBatt_POL" value="@s?.VBatt_POL" /></li>
                                                                <li><label class="form-label d-block"><strong>Continuous Freq:</strong></label><input class="form-control form-control-sm" name="Specs[@index].IsContinuousFreqSupported" value="@s?.IsContinuousFreqSupported" /></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        index++; j++;
                                    }
                                </div>
                            </div>
                        </div>
                    </form>
                }
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-warning">No design selected. Use the link from the designs list to open a design.</div>
    }
</div>

<!-- Modal: Panel Master Filter (only panel features) -->
@if (Model.Design != null)
{
    <div class="modal fade" id="panelFilterModal" tabindex="-1" aria-labelledby="panelFilterModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="panelFilterModalLabel"><i class="bi bi-sliders me-2"></i>Filter Panels by Features</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="get">
                    <div class="modal-body">
                        <input type="hidden" name="DesignId" value="@Model.Design.Id" />
                        <div class="col-12">
                            <label class="form-label d-block">Panel Features</label>
                            <div class="row row-cols-2 g-2">
                                @foreach (var feature in new[]{
                                    "PSR1_Supported","PSR2_Supported","PSR2_ET_Supported","HDR_Supported","VRR_Supported","VDSC_Version","Seamless_Drrs","xPST_Supported","OPST_ELP","DE_Early_Wake","EPSM60","EG_Endurance_Gaming"
                                })
                                {
                                    var isChecked = Model.FilterPanelFeatures != null && Model.FilterPanelFeatures.Contains(feature);
                                    <div class="col">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" name="FilterPanelFeatures" value="@feature" id="feat-@feature" @(isChecked ? "checked" : null) />
                                            <label class="form-check-label" for="feat-@feature">@feature.Replace("_"," ")</label>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Apply</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}
